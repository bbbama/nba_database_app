Bazy danych I – dokumentacja projektu
Dokumentacja projektu wykonywanego w ramach zajęć
BAZY DANYCH I

I. Projekt koncepcji, założenia

1. Zdefiniowanie tematu projektu:
   Projekt ma na celu stworzenie aplikacji bazodanowej do zarządzania danymi związanymi z ligą NBA. Aplikacja umożliwia przeglądanie, dodawanie, edycję i usuwanie informacji o zawodnikach, zespołach, meczach, kontuzjach, kontraktach, arenach, sezonach, tabelach ligowych, trenerach oraz nagrodach. System zawiera również funkcje raportowania i system autoryzacji z różnymi poziomami dostępu.

2. Analiza wymagań użytkownika:
   Projektowana baza danych ma spełniać następujące funkcjonalności:
   - Zarządzanie podstawowymi danymi ligi NBA (zawodnicy, zespoły, mecze, areny, sezony).
   - Śledzenie szczegółowych informacji o zawodnikach (kontrakty, kontuzje, nagrody, statystyki meczowe).
   - Automatyczne aktualizowanie tabeli ligowej na podstawie wyników meczów.
   - Generowanie raportów i statystyk.
   - Zapewnienie bezpieczeństwa danych poprzez system autoryzacji z rolami "admin" i "user".
   - Możliwość przeglądania i modyfikacji danych poprzez intuicyjny interfejs webowy.

3. Zaprojektowanie funkcji:
   Podstawowe funkcje realizowane w bazie danych i aplikacji to:
   - CRUD (Create, Read, Update, Delete) dla głównych encji (zawodnicy, zespoły, mecze, areny, sezony, trenerzy, kontrakty, kontuzje, nagrody, tabele ligowe, użytkownicy).
   - Generowanie raportów: średnie statystyki zawodników, tabela ligowa, najwięcej punktów w meczu, liderzy statystyk.
   - System logowania i wylogowywania.
   - Autoryzacja dostępu do poszczególnych funkcji aplikacji w zależności od roli użytkownika (admin/user).
   - Automatyczna obsługa logiki biznesowej poprzez wyzwalacze bazodanowe (np. aktualizacja tabeli ligowej).
   - Walidacja danych na poziomie bazy danych i aplikacji.

II. Projekt diagramów (konceptualny)

5. Zdefiniowanie encji (obiektów) oraz ich atrybutów.
   Główne encje w systemie obejmują:
   - **zespol**: id_zespolu, nazwa, miasto, rok_zalozenia, trener_glowny, id_arena
   - **zawodnik**: id_zawodnika, imie, nazwisko, pozycja, data_urodzenia, id_zespolu
   - **mecz**: id_meczu, data_meczu, id_gospodarza, id_goscia, wynik_gospodarza, wynik_goscia, id_sezonu
   - **statystyki_meczu**: id_statystyki, id_meczu, id_zawodnika, minuty, punkty, asysty, zbiorki (encja asocjacyjna)
   - **kontuzja**: id_kontuzji, id_zawodnika, typ_kontuzji, data_rozpoczecia, data_zakonczenia, status
   - **kontrakt**: id_kontraktu, id_zawodnika, id_zespolu, data_poczatek, data_koniec, wynagrodzenie_roczne
   - **arena**: id_arena, nazwa, miasto, pojemnosc, rok_otwarcia
   - **sezon**: id_sezonu, rok_rozpoczecia, rok_zakonczenia
   - **tabela_ligowa**: id_tabeli, id_sezonu, id_zespolu, liczba_zwyciestw, liczba_porazek, miejsce_w_tabeli
   - **trener**: id_trenera, imie, nazwisko, rola, id_zespolu
   - **nagroda**: id_nagrody, id_zawodnika, nazwa_nagrody, rok
   - **uzytkownicy**: id_uzytkownika, login, hash_hasla, rola

6. Zaprojektowanie relacji pomiędzy encjami:
   - Zespol - Zawodnik: 1-do-N (jeden zespół ma wielu zawodników)
   - Zespol - Mecz: 1-do-N (jeden zespół może być gospodarzem/gościem wielu meczów)
   - Zawodnik - Statystyki_meczu: 1-do-N (jeden zawodnik ma statystyki z wielu meczów)
   - Mecz - Statystyki_meczu: 1-do-N (jeden mecz ma statystyki wielu zawodników)
   - Zawodnik - Kontuzja: 1-do-N (jeden zawodnik ma wiele kontuzji)
   - Zawodnik - Kontrakt: 1-do-N (jeden zawodnik ma wiele kontraktów)
   - Zespol - Kontrakt: 1-do-N (jeden zespół podpisuje wiele kontraktów)
   - Zespol - Arena: 1-do-1 (jeden zespół ma jedną główną arenę, arena może być główną dla jednego zespołu)
   - Sezon - Mecz: 1-do-N (jeden sezon zawiera wiele meczów)
   - Sezon - Tabela_ligowa: 1-do-N (jednemu sezonowi odpowiada jedna tabela ligowa)
   - Zespol - Tabela_ligowa: 1-do-N (jeden zespół występuje w wielu tabelach ligowych dla różnych sezonów)
   - Zespol - Trener: 1-do-N (jeden zespół ma wielu trenerów)
   - Zawodnik - Nagroda: 1-do-N (jeden zawodnik może zdobyć wiele nagród)

   Relacje wiele-do-wielu (N:M) zostały rozbite na encje asocjacyjne, np. relacja między `zawodnik` a `mecz` jest obsługiwana przez encję `statystyki_meczu`.

III. Projekt logiczny

7. Projektowanie tabel, kluczy, indeksów:
   Poniżej przedstawiono strukturę tabel, klucze główne (PRIMARY KEY), klucze obce (FOREIGN KEY) oraz zdefiniowane indeksy. Wszystkie nazwy tabel i kolumn są w języku polskim.

   - **zespol**: id_zespolu (PK), id_arena (FK do arena.id_arena)
   - **zawodnik**: id_zawodnika (PK), id_zespolu (FK do zespol.id_zespolu)
   - **mecz**: id_meczu (PK), id_gospodarza (FK do zespol.id_zespolu), id_goscia (FK do zespol.id_zespolu), id_sezonu (FK do sezon.id_sezonu)
   - **statystyki_meczu**: id_statystyki (PK), id_meczu (FK do mecz.id_meczu), id_zawodnika (FK do zawodnik.id_zawodnika), unikalna kombinacja (id_meczu, id_zawodnika)
   - **kontuzja**: id_kontuzji (PK), id_zawodnika (FK do zawodnik.id_zawodnika)
   - **kontrakt**: id_kontraktu (PK), id_zawodnika (FK do zawodnik.id_zawodnika), id_zespolu (FK do zespol.id_zespolu)
   - **arena**: id_arena (PK)
   - **sezon**: id_sezonu (PK)
   - **tabela_ligowa**: id_tabeli (PK), id_sezonu (FK do sezon.id_sezonu), id_zespolu (FK do zespol.id_zespolu), unikalna kombinacja (id_sezonu, id_zespolu)
   - **trener**: id_trenera (PK), id_zespolu (FK do zespol.id_zespolu)
   - **nagroda**: id_nagrody (PK), id_zawodnika (FK do zawodnik.id_zawodnika)
   - **uzytkownicy**: id_uzytkownika (PK), login (UNIQUE)

   Indeksy zostały utworzone dla kluczy obcych (`idx_zawodnik_zespol`, `idx_statystyki_meczu_mecz`, `idx_statystyki_meczu_zawodnik`) w celu optymalizacji zapytań.

8. Słowniki danych:
   Większość pól tekstowych wykorzystuje typ `VARCHAR` z odpowiednio dobraną długością. Pola numeryczne to `SERIAL` (dla kluczy głównych), `INTEGER`, `SMALLINT`, `NUMERIC(12,2)` (dla wynagrodzeń). Daty są przechowywane jako `DATE`.
   Ograniczenia dziedzinowe (`CHECK`) zostały zastosowane m.in. dla:
   - `rok_zalozenia`, `rok_otwarcia`, `rok_rozpoczecia`, `rok_zakonczenia` (zakres lat).
   - `wynik_gospodarza`, `wynik_goscia`, `minuty`, `punkty`, `asysty`, `zbiorki`, `liczba_zwyciestw`, `liczba_porazek`, `wynagrodzenie_roczne`, `pojemnosc` (wartości nieujemne).
   - `status` w tabeli `kontuzja` (dozwolone wartości: 'aktywna', 'wyleczona', 'nieznany').
   - `rola` w tabeli `trener` i `uzytkownicy` (dozwolone wartości).
   - `CONSTRAINT roznorodne_druzyny CHECK (id_gospodarza <> id_goscia)` w tabeli `mecz`.

9. Analiza zależności funkcyjnych i normalizacja tabel (dekompozycja do 3NF ewentualnie BCNF):
   Struktura tabel została zaprojektowana z uwzględnieniem zasad normalizacji, dążąc do osiągnięcia trzeciej postaci normalnej (3NF) w celu eliminacji redundancji i anomalii aktualizacji. Encje asocjacyjne (np. `statystyki_meczu`) poprawnie obsługują relacje wiele-do-wielu.

11. Zaprojektowanie operacji na danych:
    a. **Widoki (Views):**
       - `widok_zawodnicy_z_zespolem`: Podstawowe informacje o zawodnikach wraz z nazwą zespołu.
       - `widok_srednie_statystyki_zawodnika`: Średnie statystyki punktów, asyst, zbiórek i minut dla każdego zawodnika. Wykorzystuje funkcje agregujące (`AVG`, `COUNT`) i grupowanie (`GROUP BY`).
       - `widok_wyniki_meczy`: Szczegółowe wyniki meczów z nazwami zespołów i sezonem.
       - `widok_liderzy_statystyk`: Zawodnicy, którzy zagrali w co najmniej 5 meczach i mają średnią powyżej 10 punktów na mecz. Wykorzystuje funkcje agregujące (`AVG`, `COUNT`), grupowanie (`GROUP BY`) oraz filtrowanie po zagregowanych danych (`HAVING`).

    b. **Funkcje wbudowane i wyzwalacze (Functions and Triggers):**
       - **Funkcja `aktualizuj_tabele_ligowa_po_meczu()`**: Procedura odpowiedzialna za automatyczną aktualizację tabeli `tabela_ligowa` po operacjach na tabeli `mecz`. Obsługuje dodawanie nowych meczów, aktualizację wyników oraz usuwanie meczów, prawidłowo modyfikując liczby zwycięstw i porażek dla zaangażowanych zespołów w danym sezonie.
       - **Wyzwalacze (`trg_aktualizuj_tabele_ligowa_insert`, `trg_aktualizuj_tabele_ligowa_update`, `trg_aktualizuj_tabele_ligowa_delete`)**: Uruchamiają funkcję `aktualizuj_tabele_ligowa_po_meczu()` odpowiednio po dodaniu, zmianie (wyników, sezonu, zespołów) lub usunięciu rekordu w tabeli `mecz`, zapewniając spójność danych między `mecz` a `tabela_ligowa`.

IV. Projekt funkcjonalny

12. Interfejsy do prezentacji, edycji i obsługi danych:
    Aplikacja webowa (PHP) zapewnia interfejsy formularzy (CRUD) dla większości kluczowych encji, w tym:
    - **Zawodnicy**: Przeglądanie listy, szczegóły, dodawanie, edycja, usuwanie.
    - **Zespoły**: Przeglądanie listy, szczegóły, dodawanie, edycja, usuwanie.
    - **Mecze**: Przeglądanie listy, szczegóły, dodawanie, edycja, usuwanie.
    - **Areny**: Przeglądanie listy, dodawanie, edycja, usuwanie.
    - **Sezony**: Przeglądanie listy, dodawanie, edycja, usuwanie.
    - **Trenerzy**: Przeglądanie listy, dodawanie, edycja, usuwanie.
    - **Kontrakty**: Przeglądanie listy, dodawanie, edycja, usuwanie.
    - **Kontuzje**: Przeglądanie listy, dodawanie, edycja, usuwanie.
    - **Nagrody**: Przeglądanie listy, dodawanie, edycja, usuwanie.
    - **Tabela Ligowa**: Przeglądanie listy, dodawanie, edycja, usuwanie.
    - **Użytkownicy (dla administratorów)**: Przeglądanie listy, dodawanie, edycja, usuwanie.

13. Wizualizacja danych:
    Aplikacja generuje następujące raporty:
    - **Średnie statystyki zawodników**: Raport przedstawiający średnie statystyki dla każdego gracza.
    - **Tabela ligowa dla sezonu**: Raport przedstawiający pozycję zespołów w danym sezonie.
    - **Zawodnik z największą liczbą punktów w jednym meczu**: Raport identyfikujący zawodnika z najlepszym wynikiem punktowym w pojedynczym meczu.
    - **Liderzy statystyk (zawodnicy z wysoką średnią punktów)**: Raport prezentujący zawodników, którzy spełniają określone kryteria statystyczne (np. minimum 5 meczów i średnia powyżej 10 punktów).

14. Zdefiniowanie panelu sterowania aplikacji:
    Główny panel sterowania to nawigacja aplikacji webowej. Zawiera ona linki do poszczególnych sekcji zarządzania danymi (np. Zawodnicy, Zespoły, Mecze, Raporty). Dostęp do niektórych sekcji (np. Zarządzanie Użytkownikami) jest ograniczony wyłącznie dla administratorów po zalogowaniu. System logowania/wylogowywania jest zintegrowany z panelem.

V. Dokumentacja

16. Wprowadzanie danych:
    Dane do systemu mogą być wprowadzane ręcznie za pośrednictwem dedykowanych formularzy w aplikacji webowej.

17. Dokumentacja użytkownika:
    (Do uzupełnienia po stworzeniu finalnej wersji aplikacji)

18. Opracowanie dokumentacji technicznej:
    Niniejsza dokumentacja techniczna ma za zadanie opisać strukturę i funkcjonalność systemu, umożliwiając dalszą rozbudowę. Kod źródłowy aplikacji PHP jest komentowany.

19. Wykaz literatury:
    (Do uzupełnienia)